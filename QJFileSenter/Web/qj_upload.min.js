function QJUpload(n){if(!(n.usercode&&n.uploadButtton&&n.secret))throw new TypeError("缺少参数！");this.options={usercode:n.usercode,secret:n.secret,upinfo:n.upinfo||"",webupconfig:JSON.stringify(n.webupconfig||{}),filecomplete:n.filecomplete||function(){},closeupwin:n.closeupwin||function(){},url:location.href,width:n.width||"50%",height:n.height||"60%",top:n.top||"15%",left:n.left||"25%",urlPrefix:"",source:"qj-upload"};this.uploadButton=document.getElementById(n.uploadButtton);this.upid=n.uploadButtton;this.url=n.fileapiurl+"/"+n.usercode+"/document/fileupload";this._init()}var qjfiledata=[];QJUpload.prototype={constructor:QJUpload,_addHander:function(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent?n.attachEvent("on"+t,i):n["on"+t]=i},_checkH5Support:function(){var t=document.createElement("input"),i=!(!window.File||!window.FileList),n=new XMLHttpRequest,r=!!window.FormData;return"multiple"in t&&i&&"onprogress"in n&&"upload"in n&&r},_init:function(){var t=this,n=this._createIframe(),i=function(){this.readyState&&"complete"!==this.readyState||t.update()};this.frameMsg=n.contentWindow;n.attachEvent?n.attachEvent("onload",i):n.onload=i;this._addHander(this.uploadButton,"click",function(){t.openWrap()});this._handleMsgReceive()},_createIframe:function(){var n=this,i=document.createElement("div"),e=document.createElement("div"),r=document.createElement("div"),f=document.createElement("div"),u=document.createElement("span"),t=document.createElement("iframe");return i.setAttribute("id","qj-wrapAll"+n.upid),i.style.display="none",f.style.cssText="width: 100%;height: 50px;background-color:#fff;margin-top: -6px;text-align: right;",e.style.cssText="display: block;position: fixed;left: 0;top: 0;width: 100%;height: 100%;z-index: 2001;background-color: #000;-moz-opacity: 0.5;opacity: .50;filter: alpha(opacity=50);",r.style.cssText="display: block;position: fixed;left: "+n.options.left+";top: "+n.options.top+";width: "+n.options.width+";height: "+n.options.height+";BACKGROUND-COLOR: #00b7ee; z-index: 2002;box-shadow: 0 0 25px rgba(0,0,0,0.7);border-radius: 5px;padding-top: 45px;",u.innerHTML="&times;",f.innerHTML=" <button id='qjclose"+n.upid+"' style='margin-top: 5px;cursor:pointer;height: 40px;margin-right: 10px;width: 120px;font-size: 14px;background-color: rgb(0, 183, 238); border: 0; color: #fff;'>确定<\/button>",u.style.cssText="width: 40px;height: 40px;position: absolute;top: 0px;right: 0px;cursor: pointer;text-align: center;line-height: 40px;color: #FFF;font-size: 30px;font-family: microsoft yahei;border-radius: 0 5px 0 0;",u.onclick=function(){i.style.display="none"},t.setAttribute("id","qj-iframe"+n.upid),t.setAttribute("name","qj-iframe"+n.upid),t.setAttribute("width","1000px"),t.setAttribute("height","600px"),t.style.cssText="width: 100%;height: 100%;z-index: 2002;border:none;background-color: #fff;",r.appendChild(t),r.appendChild(u),r.appendChild(f),i.appendChild(e),i.appendChild(r),document.getElementsByTagName("body")[0].appendChild(i),document.getElementById("qjclose"+n.upid).onclick=function(){document.getElementById("qj-wrapAll"+n.upid).style.display="none";"function"==typeof n.options.closeupwin&&n.options.closeupwin(qjfiledata,n.uploadButton)},t},_handleMsgReceive:function(){var n=this;this._addHander(window,"message",function(t){var i=JSON.parse(t.data);switch(i.type){case"filecomplete":qjfiledata=i.data;"function"==typeof n.options.filecomplete&&n.options.filecomplete(i.data);break;case"closewin":closeWrap()}})},update:function(){if("object"==typeof arguments[0]){for(var n in arguments[0])arguments[0].hasOwnProperty(n)&&(this.options[n]=arguments[0][n]);arguments[0].ts&&(this.options.ptime=arguments[0].ts)}this.frameMsg.postMessage(JSON.stringify(this.options),this.url)},openWrap:function(){var n=this;document.getElementById("qj-iframe"+n.upid).src=this.url;document.getElementById("qj-wrapAll"+n.upid).style.display="block"},closeWrap:function(){var n=this;document.getElementById("qj-wrapAll"+n.upid).style.display="none"}};